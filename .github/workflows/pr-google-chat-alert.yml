name: Deploy ## 21

# ëª…ì‹œëœ ë¸Œëœì¹˜ ëª©ë¡ë“¤ì„ base branchë¡œ í•˜ëŠ” PRì´ [ìƒì„±, ì¬ìƒì„±, head ë¸Œëœì¹˜ ë™ê¸°í™”, PR ë¦¬ë·° ì¤€ë¹„ ì™„ë£Œ] ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì›Œí¬í”Œë¡œìš° ë™ì‘
on:
  pull_request:
    branches:
      - main
      - develop
      - feature/*
      - release/*
      - hotfix/*
    types: [opened, reopened, synchronize, ready_for_review] # í•´ë‹¹ íƒ€ì…ë“¤ì€ github webhook payload íƒ€ì… ëª©ë¡ì„ ë”°ë¦…ë‹ˆë‹¤

jobs:
  deploy:
    runs-on: ubuntu-latest # ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë  GitHub Actions ëŸ¬ë„ˆì˜ OSë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

    steps:
      - name: Notify Google Chat on Pull Request
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_BODY="${{ github.event.pull_request.body }}"
          PR_USER_ID="${{ github.event.pull_request.user.id }}"
          PR_USER_LOGIN="${{ github.event.pull_request.user.login }}"

          # GitHub Actionsì˜ ì‹œê°„ì€ UTCë¡œ ì œê³µë˜ë¯€ë¡œ, Asia/Seoulë¡œ ë³€í™˜
          CURRENT_TIME_KST=$(TZ="Asia/Seoul" date '+%Y-%m-%d %H:%M:%S')

          curl -X POST \
          -H 'Content-Type: application/json' \
          -d "{\"text\": \"ğŸ¬ [Platform-Monitoring]\n\n${PR_USER_LOGIN} ë‹˜ì´ Pull Request ë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n- PR ì œëª©: ${PR_TITLE}\n- PR ë‚´ìš©: ${PR_BODY}\n- ì‹œê°: ${CURRENT_TIME_KST}\"}" \
          "${{ secrets.GOOGLE_CHAT_WEBHOOK_URL }}"
